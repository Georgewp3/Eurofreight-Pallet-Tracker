<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Pallet Tracking</title>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Palette */
            --bg0: #0f172a;
            /* slate-900 */
            --bg1: #111827;
            /* gray-900 */
            --bg2: #0b1220;
            /* deep backdrop */
            --card: #0b1220f2;
            /* glassy card */
            --card-border: #1f2937;
            /* slate-800 */
            --line: #243244;
            /* divider */
            --text: #e5e7eb;
            /* gray-200 */
            --muted: #9ca3af;
            /* gray-400 */
            --head-grad1: #22c55e;
            /* emerald-500 */
            --head-grad2: #16a34a;
            /* emerald-600 */
            --subhead: #374151;
            /* gray-700 */
            --green: #22c55e;
            /* emerald-500 buttons */
            --green-pressed: #16a34a;
            /* emerald-600 */
            --blue: #2563eb;
            /* actions */
            --blue-pressed: #1d4ed8;
            --danger: #ef4444;
            /* red-500 */
            --danger-pressed: #dc2626;
            --ok: #10b981;
            --fault: #f43f5e;

            --radius: 14px;
            --row-h: 48px;
            --shadow-lg: 0 10px 30px rgba(0, 0, 0, .35);
            --shadow-sm: 0 8px 20px rgba(0, 0, 0, .25);
        }

        * {
            box-sizing: border-box
        }

        html,
        body {
            height: 100%
        }

        body {
            margin: 0;
            font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
            color: var(--text);
            background:
                radial-gradient(1200px 600px at 15% -5%, #0ea5e91a, transparent 60%),
                radial-gradient(1200px 600px at 85% 10%, #22c55e1a, transparent 60%),
                linear-gradient(to bottom, var(--bg2), var(--bg1) 40%, var(--bg0));
        }

        .wrap {
            max-width: 1200px;
            margin: 32px auto 72px;
            padding: 0 18px;
        }

        /* Top bar */
        .top {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            align-items: center;
            gap: 18px;
            margin-bottom: 20px;
        }

        .top h1 {
            margin: 0;
            text-align: center;
            font-size: 40px;
            font-weight: 800;
            letter-spacing: .3px;
            background: linear-gradient(90deg, #fff, #a7f3d0 40%, #93c5fd 80%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 10px 30px rgba(16, 185, 129, .12);
        }

        .meta,
        .left-meta {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        label {
            font-weight: 700;
            font-size: 13px;
            color: var(--muted);
            letter-spacing: .25px;
        }

        input[type="date"],
        input[type="text"],
        input[type="number"] {
            height: 40px;
            padding: 8px 12px;
            border: 1px solid var(--card-border);
            border-radius: 10px;
            background: #0b1526;
            color: var(--text);
            outline: none;
            box-shadow: inset 0 0 0 1px rgba(255, 255, 255, .02), 0 6px 16px rgba(0, 0, 0, .25);
            transition: box-shadow .15s ease, border-color .15s ease, transform .02s ease;
        }

        input[type="text"],
        input[type="number"] {
            width: 150px;
        }

        input:focus-visible {
            border-color: #60a5fa;
            box-shadow: 0 0 0 3px rgba(96, 165, 250, .25), var(--shadow-sm);
        }

        /* Card + table */
        .table-card {
            backdrop-filter: saturate(1.2) blur(6px);
            background: linear-gradient(180deg, #0b1220f8, #0b1220ee);
            border: 1px solid var(--card-border);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow-lg);
        }

        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            table-layout: fixed;
        }

        thead tr th {
            background: linear-gradient(90deg, var(--head-grad2), var(--head-grad1));
            color: #052e16;
            color: #052e16;
            color: #052e16;
            text-shadow: 0 1px 0 rgba(255, 255, 255, .15);
            font-weight: 800;
            letter-spacing: .3px;
            border-right: 1px solid rgba(0, 0, 0, .12);
            height: 52px;
            font-size: 14px;
        }

        thead tr th:last-child {
            border-right: 0
        }

        tbody td,
        tbody th {
            border-top: 1px solid var(--line);
            height: var(--row-h);
            font-size: 15px;
        }

        tbody th {
            font-weight: 700;
            text-align: left;
            padding: 0 16px;
            color: #e7eefc;
        }

        tbody td {
            text-align: center;
            padding: 0 10px;
            color: #dbeafe;
        }

        /* Zebra + hover */
        tbody tr:not(.subhead):nth-child(odd) td,
        tbody tr:not(.subhead):nth-child(odd) th {
            background: linear-gradient(180deg, rgba(255, 255, 255, .02), rgba(255, 255, 255, .01));
        }

        tbody tr:hover td,
        tbody tr:hover th {
            background: linear-gradient(180deg, rgba(125, 211, 252, .06), rgba(59, 130, 246, .05));
        }

        .num {
            font-variant-numeric: tabular-nums;
            font-weight: 800;
            letter-spacing: .2px;
            color: #f8fafc;
        }

        /* Buttons */
        .pill {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 40px;
            height: 34px;
            padding: 0 12px;
            border-radius: 10px;
            border: 1px solid #0e7a3b;
            background: linear-gradient(180deg, #22c55e, #16a34a);
            color: #06220f;
            font-weight: 900;
            cursor: pointer;
            user-select: none;
            box-shadow: 0 6px 16px rgba(34, 197, 94, .22), inset 0 1px 0 rgba(255, 255, 255, .25);
            transition: transform .03s ease, filter .15s ease, box-shadow .15s ease, background .15s ease;
        }

        .pill:hover {
            filter: saturate(1.1) brightness(1.02);
        }

        .pill:active {
            transform: translateY(1px);
            background: linear-gradient(180deg, var(--green-pressed), #15803d);
        }

        .pill.small {
            min-width: 34px;
            height: 32px;
            font-size: 14px;
        }

        /* Section header row on right side */
        .subhead td {
            background: linear-gradient(180deg, #1f2937, #111827);
            color: #cbd5e1;
            font-weight: 800;
            border-top: 1px solid #0b1220;
            height: 46px;
            text-shadow: 0 1px 0 rgba(0, 0, 0, .4);
        }

        .subhead td.blank {
            background: transparent;
            border-top: 1px solid var(--line);
        }

        /* Status & checkbox */
        .status {
            font-weight: 900;
            letter-spacing: .3px;
        }

        .status.fault {
            color: var(--fault);
            text-shadow: 0 0 18px rgba(244, 63, 94, .25);
        }

        .status.ok {
            color: var(--ok);
            text-shadow: 0 0 18px rgba(16, 185, 129, .25);
        }

        .tick {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .tick input {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: #22c55e;
            filter: drop-shadow(0 2px 6px rgba(0, 0, 0, .25));
        }

        /* Bottom actions */
        .actions {
            display: flex;
            justify-content: center;
            gap: 14px;
            margin-top: 22px;
        }

        .danger,
        .secondary {
            border: 1px solid rgba(255, 255, 255, .12);
            border-radius: 12px;
            padding: 12px 18px;
            font-weight: 900;
            cursor: pointer;
            letter-spacing: .3px;
            box-shadow: var(--shadow-sm);
            transition: transform .03s ease, filter .15s ease, box-shadow .15s ease, background .15s ease;
        }

        .secondary {
            background: linear-gradient(180deg, var(--blue), #1e40af);
            color: #eaf2ff;
        }

        .secondary:hover {
            filter: saturate(1.1) brightness(1.03);
        }

        .secondary:active {
            transform: translateY(1px);
            background: linear-gradient(180deg, var(--blue-pressed), #1b3aa2);
        }

        .danger {
            background: linear-gradient(180deg, var(--danger), #b91c1c);
            color: #fff;
        }

        .danger:hover {
            filter: saturate(1.05) brightness(1.02);
        }

        .danger:active {
            transform: translateY(1px);
            background: linear-gradient(180deg, var(--danger-pressed), #991b1b);
        }

        /* Column widths preserved */
        col.c1 {
            width: 32%;
        }

        col.c2 {
            width: 8%;
        }

        col.c3 {
            width: 7%;
        }

        col.c4 {
            width: 7%;
        }

        col.c5 {
            width: 18%;
        }

        col.c6 {
            width: 12%;
        }

        col.c7 {
            width: 8%;
        }

        col.c8 {
            width: 6%;
        }

        col.c9 {
            width: 12%;
        }

        /* Focus ring for keyboard users */
        .pill:focus-visible,
        .danger:focus-visible,
        .secondary:focus-visible,
        input:focus-visible {
            outline: none;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, .35), var(--shadow-sm);
        }

        /* Responsive: positions unchanged; just prevents overflow */
        @media (max-width: 980px) {
            .top {
                grid-template-columns: 1fr;
            }

            .top h1 {
                order: -1;
                margin-bottom: 8px;
            }

            .left-meta,
            .meta {
                justify-self: start;
                flex-wrap: wrap;
            }

            input[type="text"],
            input[type="number"] {
                width: 130px;
            }
        }
    </style>
</head>

<body>
    <div class="wrap">
        <div class="top">
            <div class="left-meta">
                <label for="date">DATE:</label>
                <input id="date" type="date" />
            </div>
            <h1>Pallet Tracking</h1>
            <div class="meta">
                <label for="week">WEEK:</label>
                <input id="week" type="number" min="1" step="1" />
                <label for="container">CONTAINER ID:</label>
                <input id="container" type="text" />
            </div>
        </div>

        <div class="table-card">
            <table id="palletTable" aria-label="Pallet Tracking Table">
                <colgroup>
                    <col class="c1">
                    <col class="c2">
                    <col class="c3">
                    <col class="c4">
                    <col class="c5">
                    <col class="c6">
                    <col class="c7">
                    <col class="c8">
                    <col class="c9">
                </colgroup>
                <thead>
                    <tr>
                        <th>Category</th>
                        <th>Count</th>
                        <th>-1</th>
                        <th>+1</th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                    </tr>
                </thead>
                <tbody id="tbody"></tbody>
            </table>
        </div>

        <div class="actions">
            <button class="secondary" id="export">EXPORT CSV</button>
            <button class="danger" id="reset">DELETE ENTRIES</button>
        </div>
    </div>

    <script>
        /* === JS unchanged: positions + functionality preserved === */
        (function () {
            const CATEGORIES_BEFORE = [
                "LOOSE", "ΕΛΑΦΡΙΟΥ ΤΥΠΟΥ", "ΒΑΡΕΤΟΥ ΤΥΠΟΥ", "BULK", "EURO", "HALF PALLET", "MIX"
            ];
            const SKU_LIST = ["7101 NIC", "7110 LAK", "7120 LIM", "7150 LCA", "7140 FAM", "7104 PFO", "7115 CW"];
            const STORAGE_KEY = "pallet-tracking-v1";

            function defaultDateState() {
                const counts = {}; const loose = {}; const check = {};
                [...CATEGORIES_BEFORE, ...SKU_LIST].forEach(k => counts[k] = 0);
                SKU_LIST.forEach(k => { loose[k] = 0; check[k] = false; });
                return { counts, loose, check, week: "", container: "" };
            }
            function getAll() { try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || {}; } catch { return {}; } }
            function saveAll(obj) { localStorage.setItem(STORAGE_KEY, JSON.stringify(obj)); }
            function getState(dateKey) { const all = getAll(); if (!all[dateKey]) { all[dateKey] = defaultDateState(); saveAll(all); } return all[dateKey]; }
            function setState(dateKey, st) { const all = getAll(); all[dateKey] = st; saveAll(all); }

            const $ = s => document.querySelector(s);
            const tbody = $("#tbody");
            function todayISO() { const d = new Date(), m = String(d.getMonth() + 1).padStart(2, "0"), day = String(d.getDate()).padStart(2, "0"); return `${d.getFullYear()}-${m}-${day}`; }
            let dateKey = todayISO();
            $("#date").value = dateKey;

            function render() {
                const s = getState(dateKey);
                $("#week").value = s.week || "";
                $("#container").value = s.container || "";
                tbody.innerHTML = "";
                CATEGORIES_BEFORE.forEach(cat => tbody.appendChild(rowLeftOnly(cat, s)));
                tbody.appendChild(subheaderRow());
                SKU_LIST.forEach(cat => tbody.appendChild(rowFull(cat, s)));
            }

            function subheaderRow() {
                const tr = document.createElement("tr"); tr.className = "subhead";
                tr.appendChild(tdBlank()); tr.appendChild(tdBlank()); tr.appendChild(tdBlank()); tr.appendChild(tdBlank());
                tr.appendChild(newTD("LOOSE BOXES"));
                tr.appendChild(newTD("MANUAL"));
                tr.appendChild(newTD("AUTO TOTAL"));
                tr.appendChild(newTD("CHECK"));
                tr.appendChild(newTD("AUTO"));
                return tr;
            }
            function tdBlank() { const td = document.createElement("td"); td.className = "blank"; return td; }
            function newTD(t) { const td = document.createElement("td"); td.textContent = t; return td; }

            function btn(label, cls, onClick) {
                const b = document.createElement("button");
                b.type = "button"; b.className = "pill " + (cls || ""); b.textContent = label; b.addEventListener("click", onClick);
                return b;
            }
            function cellNumber(val) { const td = document.createElement("td"); td.className = "num"; td.textContent = String(val); return td; }
            function tdButton(label, onClick) { const td = document.createElement("td"); td.appendChild(btn(label === "-" ? "-1" : "+1", "", onClick)); return td; }

            function rowLeftOnly(cat, state) {
                const tr = document.createElement("tr");
                const th = document.createElement("th"); th.textContent = cat; tr.appendChild(th);
                const countCell = cellNumber(state.counts[cat] ?? 0); countCell.dataset.key = cat; tr.appendChild(countCell);
                tr.appendChild(tdButton("-", () => changeCount(cat, -1)));
                tr.appendChild(tdButton("+", () => changeCount(cat, +1)));
                for (let i = 0; i < 5; i++) tr.appendChild(document.createElement("td"));
                return tr;
            }

            function rowFull(cat, state) {
                const tr = document.createElement("tr");
                const th = document.createElement("th"); th.textContent = cat; tr.appendChild(th);

                const countCell = cellNumber(state.counts[cat] ?? 0); countCell.dataset.key = cat; tr.appendChild(countCell);
                tr.appendChild(tdButton("-", () => changeCount(cat, -1)));
                tr.appendChild(tdButton("+", () => changeCount(cat, +1)));

                const looseCell = cellNumber(state.loose[cat] ?? 0);
                looseCell.style.cursor = "text"; looseCell.title = "Click to edit";
                looseCell.addEventListener("click", () => {
                    const cur = Number(getState(dateKey).loose[cat] ?? 0);
                    const input = prompt(`Set LOOSE BOXES for ${cat}:`, String(cur));
                    if (input === null) return;
                    const val = Number(input);
                    if (Number.isFinite(val) && val >= 0) {
                        const s = getState(dateKey); s.loose[cat] = Math.trunc(val); setState(dateKey, s); updateSkuRow(cat);
                    }
                });
                tr.appendChild(looseCell);

                const manualTd = document.createElement("td");
                manualTd.appendChild(btn("-1", "small", () => changeLoose(cat, -1)));
                manualTd.appendChild(document.createTextNode(" "));
                manualTd.appendChild(btn("+1", "small", () => changeLoose(cat, +1)));
                tr.appendChild(manualTd);

                const autoCell = cellNumber(calcAutoTotal(cat));
                autoCell.dataset.autoFor = cat;
                tr.appendChild(autoCell);

                const chkTd = document.createElement("td"); chkTd.className = "tick";
                const chk = document.createElement("input"); chk.type = "checkbox"; chk.checked = !!state.check[cat];
                chk.addEventListener("change", () => { const s = getState(dateKey); s.check[cat] = chk.checked; setState(dateKey, s); updateSkuRow(cat); });
                chkTd.appendChild(chk); tr.appendChild(chkTd);

                const statusTd = document.createElement("td"); statusTd.dataset.statusFor = cat; tr.appendChild(statusTd);
                paintStatus(cat, statusTd);

                return tr;
            }

            function changeCount(cat, delta) {
                const s = getState(dateKey);
                const cur = s.counts[cat] ?? 0;
                s.counts[cat] = Math.max(0, cur + delta);
                setState(dateKey, s);
                updateLeftCount(cat);
                if (SKU_LIST.includes(cat)) updateSkuRow(cat);
            }
            function changeLoose(cat, delta) {
                const s = getState(dateKey);
                const cur = s.loose[cat] ?? 0;
                s.loose[cat] = Math.max(0, cur + delta);
                setState(dateKey, s);
                updateSkuRow(cat);
            }

            function updateLeftCount(cat) {
                const cell = tbody.querySelector(`td[data-key="${cssEscape(cat)}"]`);
                if (cell) { const s = getState(dateKey); cell.textContent = String(s.counts[cat] ?? 0); }
            }
            function calcAutoTotal(cat) {
                const s = getState(dateKey);
                const main = s.counts[cat] ?? 0;
                const loose = s.loose[cat] ?? 0;
                return main + loose;
            }
            function paintStatus(cat, td) {
                const s = getState(dateKey);
                const ok = !!s.check[cat];
                td.className = "status " + (ok ? "ok" : "fault");
                td.textContent = ok ? "OK" : "FAULT";
                const autoCell = tbody.querySelector(`td[data-auto-for="${cssEscape(cat)}"]`);
                if (autoCell) autoCell.textContent = String(calcAutoTotal(cat));
            }
            function updateSkuRow(cat) {
                const rows = [...tbody.querySelectorAll("tr")];
                const row = rows.find(r => r.firstChild && r.firstChild.tagName === "TH" && r.firstChild.textContent === cat);
                if (!row) return;
                const s = getState(dateKey);
                const nums = row.querySelectorAll(".num"); // [count, loose, auto]
                if (nums[0]) nums[0].textContent = String(s.counts[cat] ?? 0);
                if (nums[1]) nums[1].textContent = String(s.loose[cat] ?? 0);
                const statusTd = row.querySelector('td[data-status-for]');
                paintStatus(cat, statusTd);
            }
            function cssEscape(str) { return str.replace(/["\\]/g, "\\$&"); }

            /* CSV Export (unchanged) */
            function csvEscapeCell(v) { const s = String(v ?? ""); return `"${s.replace(/"/g, '""')}"`; }
            function exportCSV() {
                const s = getState(dateKey);
                const rows = [];
                const header = ["Date", "Week", "Container", "Category", "Count", "Loose Boxes", "Auto Total", "Checked", "Auto"];
                rows.push(header);
                function pushRow(cat, count, loose, checked, autoStatus) {
                    const autoTotal = (Number(count) || 0) + (Number(loose) || 0);
                    rows.push([dateKey, s.week || "", s.container || "", cat, count, loose, autoTotal, checked, autoStatus]);
                }
                CATEGORIES_BEFORE.forEach(cat => {
                    const count = s.counts[cat] ?? 0; pushRow(cat, count, 0, "", "");
                });
                SKU_LIST.forEach(cat => {
                    const count = s.counts[cat] ?? 0;
                    const loose = s.loose[cat] ?? 0;
                    const checked = s.check[cat] ? "TRUE" : "FALSE";
                    const status = s.check[cat] ? "OK" : "FAULT";
                    pushRow(cat, count, loose, checked, status);
                });
                const csv = "\uFEFF" + rows.map(r => r.map(csvEscapeCell).join(",")).join("\n");
                const blob = new Blob([csv], { type: "text/csv;charset=utf-8" });
                const a = document.createElement("a");
                a.href = URL.createObjectURL(blob);
                a.download = `pallet-tracking_${dateKey}.csv`;
                document.body.appendChild(a);
                a.click();
                setTimeout(() => { URL.revokeObjectURL(a.href); a.remove(); }, 0);
            }

            /* Inputs */
            $("#date").addEventListener("change", e => { dateKey = e.target.value || todayISO(); getState(dateKey); render(); });
            $("#week").addEventListener("input", e => { const s = getState(dateKey); s.week = e.target.value; setState(dateKey, s); });
            $("#container").addEventListener("input", e => { const s = getState(dateKey); s.container = e.target.value; setState(dateKey, s); });
            $("#reset").addEventListener("click", () => {
                if (!confirm("Delete all entries for this date?")) return;
                const all = getAll(); all[dateKey] = defaultDateState(); saveAll(all); render();
            });
            $("#export").addEventListener("click", exportCSV);

            render();
        })();
    </script>
</body>

</html>